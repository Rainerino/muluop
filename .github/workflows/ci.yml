name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # --- ADDED STEP START ---
      # This action removes pre-installed tools (Android, Dotnet, etc.)
      # to prevent "No space left on device" errors during Bazel builds.
      - name: Free Disk Space (Ubuntu)
        uses: jlumbroso/free-disk-space@v1.3.1
        with:
          tool-cache: true
          android: true
          dotnet: true
          haskell: true
          large-packages: true
          docker-images: true
          swap-storage: true
      # --- ADDED STEP END ---

      - name: Setup Bazel
        uses: bazelbuild/setup-bazelisk@v3

      - name: Build
        # Adding --disk_cache is optional but recommended if you add caching later
        run: bazel build //...

      - name: Test
        run: bazel test //...